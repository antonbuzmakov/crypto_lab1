# Название протокола: RSA-Z-Auth Protocol v1.0

Цель протокола:
Обеспечить защищенный обмен сообщениями между двумя сторонами (Алисой и Бобом) с взаимной аутентификацией на основе RSA и последующим шифрованием трафика с использованием AES.

### Участники:

- Алиса (A) — клиент, инициатор соединения

- Боб (B) — сервер, принимающая сторона

Предварительные условия:

- Каждая сторона имеет сгенерированную пару RSA ключей (2048 бит)

- Каждая сторона хранит свой приватный ключ в секрете

- Публичные ключи будут обменены в начале сеанса

## Этапы протокола:

Этап 1: Установление TCP-соединения
text
Алиса устанавливает TCP-соединение с Бобом по указанному IP-адресу и порту.
Этап 2: Обмен публичными ключами RSA
text
Боб → Алиса: Pub_B (публичный ключ Боба в PEM формате)
Алиса → Боб: Pub_A (публичный ключ Алисы в PEM формате)

    Цель: Каждая сторона получает аутентичный публичный ключ собеседника для последующей проверки подписей.

Этап 3: Взаимная аутентификация

1. Аутентификация Боба:
   Боб → Алиса: {N_B}, Sign_PrivB({N_B})
   где:
   - N_B = случайное число (16 байт), одноразовый номер
   - Sign_PrivB = подпись RSA-PSS с SHA-256 приватным ключом Боба

   Алиса проверяет: Verify_PubB({N_B}, Signature)
   Если проверка успешна → Боб аутентифицирован

2. Аутентификация Алисы:
   Алиса → Боб: {N_A}, Sign_PrivA({N_A})
   Боб проверяет: Verify_PubA({N_A}, Signature)
   Если проверка успешна → Алиса аутентифицирована

Этап 4: Обмен сессионным ключом
text
Алиса → Боб: RSA-OAEP-Enc_PubB(K_AB), Sign_PrivA(Hash(RSA-Enc_PubB(K_AB)))
где:

- K_AB = случайный сессионный ключ AES-256 (32 байта)
- RSA-OAEP-Enc_PubB = шифрование RSA-OAEP с SHA-256 публичным ключом Боба
- Sign_PrivA = подпись RSA-PSS с SHA-256 приватным ключом Алисы

  Боб:

1. Проверяет подпись: Verify_PubA(Signature)
2. Расшифровывает: RSA-OAEP-Dec_PrivB(encrypted_key) → K_AB
3. Отправляет подтверждение: "OK"

Этап 5: Защищенное общение
text
Алиса ↔ Боб: AES-256-GCM(K_AB, Message, IV)
где:

- Каждое сообщение шифруется с уникальным IV (12 байт)
- GCM режим обеспечивает конфиденциальность и аутентификацию
- Формат сообщения: [IV (12)][Tag (16)][Ciphertext (N)]
